【はじめに】
ダウンロードいただきありがとうございます。
このプログラムは、UTAU用の合成エンジンをマルチコアで動作させることで、wav
のレンダリングおよび周波数表の作成を高速化するものです。

Thanks for downloading this program.
It is a wrapper of the UTAU resampler, and speeds up rendering wav and
generating frequency map.


【使い方 (Usage)】
インストーラーを起動して、高速化したい合成エンジンを選択してから[インストー
ル]ボタンを押してください。

Please add the resamplers at the setup screen, and click [Install] button.


【動作原理】
インストール時に選択された合成エンジンは、resamplerという名称のサブフォル
ダーに移動され、エンジンが元々あった場所には、このプログラムがコピーされ
ます。これにより、wavをレンダリングするときや周波数表を作成するときは、こ
のプログラムがまず呼び出されるようになります。

呼び出された後の動作は以下の通りです。

1. 親プロセスがcmd.exeではない場合は、オリジナルのエンジンをそのまま実行
します。
たとえば、周波数表が作成されていない音素を、原音設定エディタで開いてPボ
タンで再生すると、その場で周波数表が作成されますが、そのようなケースが該
当します。

2. 親プロセスがcmd.exeだった場合は、環境変数cachedirが存在するかどうかを
調べます。
cachedirが存在する場合は、wavのレンダリングモードであると判断します。
cachedirが存在しない場合は、周波数表の一括作成モードであると判断します。

3. wavのレンダリングモードであると判断した場合は、cmd.exeの引数からバッ
チファイル名を取得し、バッチファイルを解析します。
次に、エンジンによる各ノートのwav作成に使われている引数と、wavtoolによる
wav結合に使われている引数をリスト化します。
最後に、複数個のエンジンとひとつのwavtoolを並列実行することで、レンダリ
ング速度の向上を図ります。
なお、エンジンの個数は、GetSystemInfo関数で取得した論理コアの数です。
また、/フラグが指定されていた場合は、エンジンの種類を切り替えます。
※wavtoolも並列化できればもっと高速化できるのではないかと思うのですが、
それは今後の課題ということで…。

4. 周波数表の一括作成モードであると判断した場合は、cmd.exeの引数からバッ
チファイル名を取得します。
バッチファイル名がtemp.batだった場合は、[周波数表を初期化]ボタンによる一
括作成モードであると判断します。
バッチファイル名がregen.batだった場合は、隠し機能による一括作成モードで
あると判断します。
いずれの場合も、バッチファイルを解析して周波数表作成に使われている引数を
リスト化します。
最後に、複数個のエンジンを並列実行することで、周波数表作成速度の向上を図
ります。
なお、エンジンの個数は、GetSystemInfo関数で取得した論理コアの数です。

以上のように、UTAUによるエンジンの呼び出し方や、UTAUが作成するバッチファ
イルに非常に依存した作りになっています。したがって、UTAUの将来のバージョ
ンでは動作しない可能性がありますのでご注意ください。


【動作確認環境】
OS: Windows 7 Ultimate x86 日本語版
CPU: Core 2 Duo
UTAU: Version 0.2.77


【確認がとれていない環境】
Cadenciiからエンジンを呼びだした場合の動作が未確認です。修羅場Pさん、せっ
かくアドバイスをいただいたのにすみません…。


【アンインストール方法 (How to uninstall)】
コントロールパネルの「プログラムの追加と削除」もしくは「プログラムと機能」
で、「UTAU resampler パッチ」を選択してアンインストールしてください。

Open 'Add or remove programs' of the control panel, and uninstall 'UTAU
resampler patcher' to uninstall it.


【Special Thanks】
このプログラムを作成するにあたり、多くの方からアドバイスやご協力をいただ
きました。この場をお借りしてお礼申し上げます。

遊牧家族さん、内藤魅亜さん、句読点P、さん、わねこさん、クロエさん、葵大
樹さん、修羅場Pさん、Nillaさん、Feliさん、Angelialieさん、Shivaさん、エ
ヤさん、JadeLaundersさん、Keiichiさん、kharさん、LEIさん、Tadyさん、Giza
さん、Yoruさん、Namiさん、Dorelさん、cdblueさん、Anna-Meiさん、内野ねこ
さん、dkさん、キハ22さん、Zteerさん、Lotteさん、まる@Loopさん、飴屋／菖
蒲さん


【連絡先】
http://twitter.com/namiyome


【変更履歴】
Ver.1.4 (Nov. 26, 2011)
■高速化ツール
- wavファイルをレンダリングするとき、コンソール画面に合成エンジンのフル
パスを出力するようにしました。
- Ver.1.3で導入した、エンジンを切り替える機能のフラグ文字をeから/(スラッ
シュ)に変更しました。なお、engine.iniで文字を変更することもできます。
- 合成エンジンを実行するさいに、/フラグを削除するようにしました。
- engine.iniの場所を%ALLUSERSPROFILE%\UTAU Plugin\resampler wrapperフォ
ルダーに変更しました。
- engine.iniにエンジンのフルパスを指定できるようにしました。
- Breが指定されていないとbkh01.exeが落ちる環境があるらしいのでその回避
策を盛り込みました。bkh01.exeを実行する場合のみ、何も指定がなければ
「Bre50」を渡します。
■インストーラー
- オランダ語に対応しました。
- bkh01.exeを処理する場合はfftsg.dllをresamplerフォルダーにコピーするよ
うにしました。
- 従来はUTAUと同じフォルダーにある合成エンジンしか自動的にはリストアッ
プされませんでしたが、マニュアルで指定したことがあるエンジンについても、
上書きインストール時にリストアップするようにしました。初回だけはマニュ
アルで指定しなければなりませんが、二回目以降は省力化されます。
■プラグイン
- /フラグを設定するためのプラグインを用意しました。

Ver.1.3 (Nov. 5, 2011) ※テストバージョンです
■高速化ツール
- 環境変数paramsの文字数が長すぎてエンジンの起動に失敗した場合は、params
を渡さずにエンジンを起動するようにしました。
- logTIPS.exeを使用する場合、同時実行するとログファイルの共有エラーが発
生するため、1個だけlogTIPS.exeを実行するようにしました（それでも、wavを
レンダリングするのであればwavtoolを同時に実行する処理は残りますので、デ
フォルトよりは多少速度は向上するはずです。ただし周波数表を作成する場合は
速度は向上しません。むしろラッパーを通る分だけわずかに遅くなるはず…）。
- 試験的に、eフラグでエンジンを切り替えられる機能を追加しました。eフラグ
を指定しなかった場合はustファイルのデフォルトのエンジンを使います。

Ver.1.2 (Nov. 4, 2011)
■高速化ツール
- ビブラートをかけた長いノート等、環境変数paramsの文字数が長いときに途中
で切れてしまう不具合を修正しました。
- キャッシュを使わない設定のときにwavをレンダリングできない不具合を修正
しました。

Ver.1.1 (Oct. 29, 2011)
■高速化ツール
- コマンドプロンプトからエンジンを実行した場合、周波数表一括作成モードで
あると誤認識していた不具合を修正し、オリジナルのエンジンを呼びだすように
しました。
■インストーラー
- イタリア語に対応しました。

Ver.1.0 (Oct. 28, 2011)
- ファーストリリース
